<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Modern Boy's Art</title>
    <style>
        /* 1. 화면 기본 설정 */
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden; /* 스크롤 방지 */
            background-color: #f4f1ea; /* 배경색 */
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: sans-serif;
        }

        .art-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 800px; /* PC에서 너무 커짐 방지 */
            overflow: hidden;
        }

        /* 2. 그림 레이어 스타일 */
        .layer {
            position: absolute;
            /* 움직일 여백 확보를 위해 120%로 설정 */
            width: 120%;
            height: 120%;
            top: -10%;  /* 중앙 정렬 보정 */
            left: -10%;
            
            /* ⭐ 가로 폭을 화면에 딱 맞춤 (너무 확대되는 것 방지) ⭐ */
            background-size: 100% auto; 
            
            /* 그림 위치: 중앙 기준 */
            background-position: center; 
            background-repeat: no-repeat;
            
            /* 움직임 부드럽게 */
            transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            will-change: transform;
        }

        /* 3. 이미지 파일 연결 (파일명 정확히!) */
        .bg { background-image: url('bg.png'); z-index: 1; }
        .mid { background-image: url('mid.png'); z-index: 2; }
        .fore { background-image: url('fore.png'); z-index: 3; }

        /* 4. 입장 버튼 스타일 */
        #permissionBtn {
            position: absolute;
            z-index: 9999; /* 제일 위에 오도록 설정 */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            
            background-color: #a63737; /* 버튼 색 */
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            
            /* 터치 영역 확보 */
            min-width: 200px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="art-container" id="artContainer">
        <div class="layer bg" data-speed="1"></div>
        <div class="layer mid" data-speed="2"></div>
        <div class="layer fore" data-speed="4"></div>
    </div>

    <button id="permissionBtn" type="button">작품 입장하기 (Click)</button>

    <audio id="bgm" loop>
        <source src="music.mp3" type="audio/mp3">
    </audio>

    <script>
        // 변수 가져오기
        const btn = document.getElementById('permissionBtn');
        const layers = document.querySelectorAll('.layer');
        const container = document.getElementById('artContainer');
        const bgm = document.getElementById('bgm');

        // 1. 음악 페이드 인 함수
        function fadeInAudio(audio) {
            try {
                audio.volume = 0;
                const playPromise = audio.play();
                
                // 브라우저 정책상 재생 실패할 경우 대비
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        // 재생 성공 시 볼륨 올리기
                        let vol = 0;
                        const interval = setInterval(() => {
                            if (vol < 0.8) {
                                vol += 0.05;
                                audio.volume = vol;
                            } else {
                                clearInterval(interval);
                            }
                        }, 200);
                    }).catch(error => {
                        console.log("음악 재생 실패(파일 경로 확인): " + error);
                    });
                }
            } catch (e) {
                console.log("오디오 오류: " + e);
            }
        }

        // 2. 그림 움직임 계산 함수
        function moveLayers(x, y) {
            layers.forEach(layer => {
                const speed = layer.getAttribute('data-speed');
                const xMove = -(x * speed); 
                const yMove = -(y * speed);
                layer.style.transform = `translate(${xMove}px, ${yMove}px)`;
            });
        }

        // 3. 모바일 센서 처리 함수
        function handleOrientation(event) {
            const x = event.gamma; // 좌우 기울기
            const y = event.beta;  // 앞뒤 기울기
            
            if (x !== null && y !== null) {
                const limitedX = Math.max(-45, Math.min(45, x));
                const limitedY = Math.max(-45, Math.min(45, y));
                moveLayers(limitedX * 0.15, limitedY * 0.15); // 감도 0.15
            }
        }

        // 4. PC 마우스 처리 함수
        container.addEventListener('mousemove', (e) => {
            const x = (window.innerWidth / 2 - e.pageX) / 50;
            const y = (window.innerHeight / 2 - e.pageY) / 50;
            moveLayers(x, y);
        });

        // 5. 버튼 클릭 시 실행 (메인 기능)
        btn.addEventListener('click', function() {
            // 버튼 숨기기
            btn.style.display = 'none';

            // 음악 재생 시도
            if(bgm) fadeInAudio(bgm);

            // 아이폰(iOS 13+) 권한 요청
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                        } else {
                            alert('센서 권한을 허용해야 그림이 움직입니다.');
                        }
                    })
                    .catch(console.error);
            } else {
                // 안드로이드 및 PC는 바로 실행
                window.addEventListener('deviceorientation', handleOrientation);
            }
        });
    </script>
</body>
</html>